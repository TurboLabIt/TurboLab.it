## 🚨 WARNING 🚨
#
# This file is under version control!
# DO NOT EDIT DIRECTLY - If you do, you'll loose your changes!
#
# The original file is in `/var/www/turbolab.it/config/custom/`
#
# You MUST:
#
# 1. edit the original file on you PC
# 2. Git-commit+push the changes
# 3. run `sudo bash /var/www/turbolab.it/scripts/deploy.sh`
#
# ⚠️ This file is SHARED among dev|staging|prod ⚠️
#
# 🪄 Based on https://github.com/TurboLabIt/webstackup/blob/master/my-app-template/config/custom/nginx-symfony.conf

set $APP_NAME turbolab.it;

## 🌎 public webroot ("htdocs")
root $PROJECT_DIR/public;

## 🔢 PHP version to use
set $PHP_VER 8.3;

## 🧰 Maintenace - To activate:
# https://github.com/TurboLabIt/webstackup/blob/master/my-app-template/scripts/maintenance.sh
#include /usr/local/turbolab.it/webstackup/config/nginx/06_maintenace.conf;

## 🛣 Redirect map
if ($wsuRedirectToMapTurbolabit) {
  return 301 $wsuRedirectToMapTurbolabit;
}

## 👉🏻 Extra-security (requires a valid HTTPS certificate)
#include /usr/local/turbolab.it/webstackup/config/nginx/70_security.conf;

## 👮 Restricted folder
location /restricted-folder/ {

  satisfy all;
  include /etc/turbolab.it/webstackup-nginx-allow-deny-list*.conf;
  deny all;

  ## Auth
  auth_basic "Restricted folder";
  auth_basic_user_file /usr/local/turbolab.it/webstackup/autogenerated/httpauth_welcome;

  try_files $uri /index.php$is_args$args;
}

## 💬 phpBB (forum)
include /usr/local/turbolab.it/webstackup/config/nginx/10_phpbb_forum_location.conf;

## 📐 Symfony
include /usr/local/turbolab.it/webstackup/config/nginx/07_symfony_location.conf;

## 🫴🏻 Shared Nginx config
include /usr/local/turbolab.it/webstackup/config/nginx/common-bundle.conf;

## 🧹 Clean the root
include /usr/local/turbolab.it/webstackup/config/nginx/95_clean_root.conf;

## 🏃‍♂️ Async runner (requires a related cron job)
#include /usr/local/turbolab.it/webstackup/config/nginx/45_async-runner-request.conf;

## 📃 Logging
error_log /var/log/nginx/turbolab.it_error.log;
access_log /var/log/nginx/turbolab.it_access.log;
